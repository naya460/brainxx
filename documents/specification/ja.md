# brainxxとは
brainfuckに大量の命令を追加して、少し実用的にした難解プログラミング風言語です。  
読み方は「ブレインエックス」です。  

# プログラムの構成
プログラムは0個以上の命令(operation)で構成されます。  
命令はスペースなどを入れず、連続して書くことができます。  
  
命令は1個以上の文字で構成されます。文字は、以下の3種類に分けられます。  
- 非終端文字  
    次の文字も同じ命令であることを示します。  
    この文字で命令が終わることはありません。
- 終端文字  
    この文字が命令の終わりであることを示します。  
- 正の整数  
    0から9が1個以上並び、10進数で示されます。  
    それ以外の文字が出現したら判定を終わります。  

命令として解釈できない文字はスキップされ、コメントとして扱われます。  
ただし、命令の途中(非終端文字の後)ではコメントとして扱われません。  
このとき、不正な命令としてコンパイルエラー(または実行の中止)となります。  

# プログラムの動作
## メモリ
プログラムは、十分な長さを持ったメモリ上で実行されます。  
メモリ上の1つの値は、符号有り整数で8bit以上(32bit以上推奨)です。  
  
現在操作するメモリ位置(current pointer、以降cptr)があります。  
現在のcptrの指す値や、現在のメモリ位置自体を動かすことによって、プログラムが動作します。  
cptrを1増やすとは、次の値(スタックの伸びる方向)に移動するということを意味します。  
  
関数の最初のメモリ位置をbase pointer(以降bptr)と呼びます。  
bptrの位置は利用できるメモリ外であっても良いです。  
そのため、関数の最初では必ずcptrを1増やして作成してください。  

## スタック
cptrの指すメモリは、スタックとして使用することができます。  
スタックのアドレスは正の方向に伸びていきます。  
cptrの指すメモリがスタックの最上位ですが、基本的にその外側も保持します。  
ただし、関数を呼びだしたときには、外側の値は保証されません。  

スタックでは、主に以下の操作が行なわれます。
- pop  
    値を取り出し、cptrを1減らす。  
- push  
    cptrを1増やし、値を入れる。  

# 命令一覧
正の整数を`__num__`と記述します。  

## スタック
先に取得した値が中置記法の右値として扱います。  

- `+` stack inc  
    cptrが指す値を1増やす  
  
- `-` stack dec  
    cptrが指す値を1減らす  
  
- `$__num__` stack push  
    __num__をpushする。
  
- `$+` stack add  
    値を2つpopし、加算した値をpushする。  
  
- `$-` stack sub  
    値を2つpopし、減算した値をpushする。  
  
- `$*` stack mul  
    値を2つpopし、乗算した値をpushする。  
  
- `$/` stack div  
    値を2つpopし、除算した値をpushする。  
  
- `$%` stack mod  
    値を2つpopし、剰余をpushする。  
  
- `$$` stack dup  
    値を1つpopし、その値を2回pushする。  
  
- `$#` push arg  
    値を1つpopし、取得した値番目の引数をpushする。  
    1が最初の引数です。  

### スタック(比較)
値が条件を満たしているとき1を、満たしていないとき0をpushする。  

- `$<` stack cl  
    値を2つpopし、左値が小さいとき、条件を満たす。  
  
- `$>` stack cg  
    値を2つpopし、左値が大きいとき、条件を満たす。  

- `$==` stack eq  
    値を2つpopし、値が同じとき、条件を満たす。  

- `$=<` stack el  
    値を2つpopし、値が同じか左値が小さいとき、条件を満たす。  

- `$=>` stack eg  
    値を2つpopし、値が同じか左値が大きいとき、条件を満たす。  

- `$=!` stack ne  
    値を2つpopし、値が異なるとき、条件を満たす。  

### スタック(ビット演算)
- `$|` stack or  
    値を2つpopし、論理和をpushする。  

- `$&` stack and  
    値を2つpopし、論理積をpushする。  

- `$^` stack xor  
    値を2つpopし、排他的論理和をpushする。  

- `$~` stack not  
    値を2つpopし、ビット反転した値をpushする。  

- `$[` stack shl  
    値を2つpopし、左値を右値回左論理シフトした値をpushする。  

- `$]` stack shr  
    値を2つpopし、左値を右値回右論理シフトした値をpushする。  

### スタック(ポインタ処理)
スタックの伸びる方向を後、スタックの始点の方向を前とします。  

- `$:^` push cptr  
    現在のcptrをpushする。

- `$:~` push bptr  
    現在のbptrをpushする。

- `$:+` ptr add  
    左辺のポインタから右値個後の値に移動する。

- `$:-` ptr sub  
    左辺のポインタから右値個前の値に移動する。

- `$:+` ptr get  
    値を1つpopし、そのポインタの指す値をpushする。

## タグ
- `::__num__` tag def  
    tag__num__形式のタグを宣言する。

- `:>__num__` tag jmp  
    tag__num__に移動する。

## 関数
- `#:__num__` fn def  
    fn__num__形式の関数を宣言する。  

- `#>__num1__:__num2__` fn call  
    fn__num1__関数を__num2__個を引数としてpopし、返り値をpushする。  

- `#<` fn ret  
    値を1つpopし、それを返り値として関数を抜ける。  

- `#~__num__` fn pub  
    fn__num__関数を外部に公開する。  

## 操作
メモリの伸びる方向を後、メモリの始点の方向を前とします。  

- `<` ctrl spl  
    cptrを1つ後に移動。  

- `>` ctrl spr  
    cptrを1つ前に移動。  

- `[` ctrl repb  
    cptrの指す値が0のとき、対応する`]`の次の命令に移動する。  

- `]` ctrl repe  
    対応する`[`に移動する。  

- `@` mov cptr  
    値を1つpopし、その値が指す場所にcptrを移動する。  

## 入出力
ascii互換文字とは、asciiコードをそのまま用いることのできる文字コードとします。  
asciiコードやUTF-8などなどが含まれます。  
ascii文字以外は環境依存となります。  

入出力処理は、必ずしも実装する必要はありません。  

- `.` io cout  
    cptrが指す値をascii互換文字として出力する。  

- `,` io cin  
    cptrが指す場所にascii互換文字として入力する。